#!perl
use v5.24.0;
use warnings;

use lib 'lib';

use IO::Async::Loop;
use IO::Async::Timer::Periodic;
use Synergy::Channel::Slack;
use Synergy::Channel::Twilio;
use Synergy::Reactor::SlackID;
# use Synergy::EventHandler::SlackID;
use Synergy::Reactor::Announce;
use Synergy::Reactor::Echo;
use Synergy::Reactor::Clox;
use Synergy::Reactor::LiquidPlanner;
use Synergy::Hub;

my $key = qx(cat ~/.jem.key);
chomp $key;

my $twilio_key = 'foo';  # XXX fixme

my $synergy = Synergy::Hub->synergize({
  ($ENV{SYNERGY_USERS_FILE}
    ? (user_directory => $ENV{SYNERGY_USERS_FILE})
    : ()),
  channels => {
    'slack-fm' => {
      class   => 'Synergy::Channel::Slack',
      api_key => $key,
    },
    twilio  => {
      class   => 'Synergy::Channel::Twilio',
      api_key => $twilio_key,
    },
  },
  reactors => {
    clox    => { class => 'Synergy::Reactor::Clox' },
    echo    => { class => 'Synergy::Reactor::Echo' },
    lp      => { class => 'Synergy::Reactor::LiquidPlanner' },
    slackid => { class => 'Synergy::Reactor::SlackID' },
    announce=> {
      class => 'Synergy::Reactor::Announce',
      slack_channel_name => 'slack-fm',
      announce_chan_name => 'bottest',
    }
  },
  server_port => 8118,
});

$synergy->loop->run;
